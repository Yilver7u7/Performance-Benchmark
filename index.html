<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JS Performance Benchmark</title>
    <link rel="stylesheet" href="./index.css">
</head>
<body>
    <main class="container">
        <h2>Global</h2>
        <textarea class="code" id="global" rows="1">const data = [...Array(1000).keys()]</textarea>
        
        <h2>Text Cases</h2>
        
        <div class="test-cases">
            <article class="test-case">
                <header>
                    <span class="test-id">1</span>
                    <span class="ops"> 203</span>
                </header>
                
                <textarea class="code" rows="1">data.find( x => x == 100)</textarea>
            </article>
            
            <article class="test-case">
                <header>
                    <span class="test-id">2</span>
                    <span class="ops"> 233</span>
                </header>
                
                <textarea class="code" rows="1">data.find( x => x == 450)</textarea>
            </article>

        </div>
    </main>

    <button class="send-button"> Enviar</button>

    <script type="module">
        const $globalCode = document.querySelector('#global');
        const $sendButton = document.querySelector('.send-button');

        async function runTestCase(){
            // Where is the magic work ðŸ§™
            const $testCases = document.querySelectorAll('.test-case');
            const globalCode = $globalCode.value

            
            /*Lo que sucede aqui es que termina saturando el hilo de trabajo
            */
            async function runTest({ code, data }) {
                const worker = new Worker('worker.js')
            worker.postMessage({ code, data, duration: 1000 })
            return new Promise( resolve => {
                worker.onmessage = event => {
                    console.log('El worker dice:', event.data)
                    resolve(event.data);
                }
            })
            }

            //Podemos traer cada uno de los elementos de una seccion especifica
            $testCases.forEach( async testCase => {
                const $code = testCase.querySelector('.code');
                const $ops = testCase.querySelector('.ops');

                // obtenermos el valor de la etiquera y lo modificamos
                const codeValue = $code.value;
                $ops.textContent = 'Cargando...'
                console.log( codeValue )

                const result = await runTest({ code: codeValue, data: globalCode })
                console.log( result)

            })
        }

        //run test cases on init
        runTestCase();

        $sendButton.addEventListener('click', () => {
            runTestCase();
        })

    </script>

</body>
</html>